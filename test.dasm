; OCtOS v0.1 for DCPU-16
; By Elarcis

:screenmainmenu
     JSR clrscreen
     SET I, 0

     :screenmainmenu_loop
     SET J, 0

     SET A, strmainmenutitle
     SET X, 0
     SET Y, 0
     JSR printstring

     SET A, strmainmenustatus
     SET X, 1
     ADD Y, 2
     SET [0x7000 + J], screenstatus
     IFE I, J
	 SET C, 0x10f
     JSR setcolor
     JSR printstring
     SET C, 0

     SET A, strmainmenubla0
     SET X, 1
     ADD Y, 1
     ADD J, 1
     SET [0x7000 + J], screenbla
     IFE I, J
	SET C, 0x10f
     JSR setcolor
     JSR printstring
     SET C, 0

     SET A, strmainmenubla1
     SET X, 1
     ADD Y, 1
     ADD J, 1
     SET [0x7000 + J], screenbla
     IFE I, J
SET C, 0x10f
     JSR setcolor
     JSR printstring
     SET C, 0

     SET A, strmainmenuabout
     SET X, 1
     ADD Y, 1
     ADD J, 1
     SET [0x7000 + J], screenabout
     IFE I, J
	SET C, 0x10f
     JSR setcolor
     JSR printstring
     SET C, 0

     SET A, strmainmenufoot
     SET X, 0
     SET Y, 15
     JSR printstring

     IFE [0x9000], 3
JSR screenmainmenu_up
     IFE [0x9000], 4
JSR screenmainmenu_down
     IFE [0x9000], 10
SET PC, [0x7000 + I]
     SET [0x9000], 0

     SET PC, screenmainmenu_loop

     :screenmainmenu_up
          SET PUSH, Z
          SET Z, I
          IFG I, 0 
SUB Z, 1
          IFE I, 0 
SET Z, J
          SET I, Z
          SET Z, POP
          SET PC, POP

     :screenmainmenu_down
          SET PUSH, Z
          SET Z, I
          IFG J, I 
ADD Z, 1
          IFE J, I 
SET Z, 0
          SET I, Z
          SET Z, POP
          SET PC, POP

:screenstatus
     JSR clrscreen

     :screenstatus_loop
     SET A, strshipstatus
     SET X, 0
     SET Y, 0
     JSR printstring

     SET A, strgeneralstatus
     SET X, 1
     ADD Y, 1
     JSR printstring

     SET A, 60
     ADD Y, 1
     JSR printstatusbar

     SET A, strenginestatus
     SET X, 1
     ADD Y, 1
     JSR printstring

     SET A, 90
     ADD Y, 1
     JSR printstatusbar

     SET A, strshieldstatus
     SET X, 1
     ADD Y, 1
     JSR printstring

     SET A, 40
     ADD Y, 1
     JSR printstatusbar

     SET A, strwhateverstatus
     SET X, 1
     ADD Y, 1
     JSR printstring

     SET A, 19
     ADD Y, 1
     JSR printstatusbar

     SET A, strnavinfos
     SET X, 0
     SET Y, 15
     JSR printstring

     IFE [0x9000], 32
SET PC, screenmainmenu
     SET [0x9000], 0

     SET PC, screenstatus_loop

:screenbla
     JSR clrscreen

     :screenbla_loop

     SET A, strnavinfos
     SET X, 0
     SET Y, 15
     JSR printstring

     IFE [0x9000], 32 
SET PC, screenmainmenu
     SET [0x9000], 0

     SET PC, screenbla_loop

:screenabout
     JSR clrscreen

     :screenabout_loop

     SET A, strnavinfos
     SET X, 0
     SET Y, 15
     JSR printstring

     IFE [0x9000], 32 
SET PC, screenmainmenu
     SET [0x9000], 0

     SET PC, screenabout_loop

:printstatusbar
     SET PUSH, Y
     MUL Y, 32
     ADD Y, 1

     SET PUSH, A
     DIV A, 4

     SET I, 0
     SET J, 0x8000
     ADD J, Y
     SET X, J

     IFG A, 19 
SET B, 0x0a00
     IFG 19, A 
SET B, 0x0200
     IFG 13, A 
SET B, 0x0e00
     IFG 5, A 
SET B, 0x4e80
     IFG 5, A 
ADD B, [printstatusbar_warnchar]
     IFE A, 5 
BOR B, [printstatusbar_char]
     IFG A, 5 
BOR B, [printstatusbar_char]

     JSR printstatusbar_printbar

     SET B, 0x0400
     BOR B, [printstatusbar_char]
     SET A, 25

     JSR printstatusbar_printbar

     SET A, POP
     SET Y, POP

     SUB X, 0x8000
     ADD X, 1
     SET PUSH, C
     SET C, 0x1f0

     SET B, A
     DIV A, 10
     SET A, 496
     JSR printcharatx

     MUL A, 10
     SUB B, A
     SET A, B
     ADD X, 1
     JSR printcharatx

     SET C, POP
     SET PC, POP

     :printstatusbar_printbar
          IFE I, 25 
SET PC, POP
          IFE I, A 
SET PC, POP
          SET [X], B
          ADD I, 1
          ADD X, 1
          SET PC, printstatusbar_printbar

     :printstatusbar_char
          DAT "~"
     :printstatusbar_warnchar
          DAT "!"

:printstring
     JSR xytox
     JSR printstringatx
     SET PC, POP

:printstringatx
     :printstring_loop
          SET C, [A]
          IFE C, 0 
SET PC, POP
          IFG C, 0xff 
JSR setcolor
          IFG C, 0xff 
ADD A, 1
          IFG C, 0xff 
SET PC, printstring_loop
          BOR C, Z
          SET [0x8000 + X], C
          ADD A, 1
          ADD X, 1
          SET PC, printstring_loop

:printchar
     JSR xytox
     JSR printcharatx
     SET PC, POP

:printcharatx
     JSR setcolor
     BOR A, Z
     SET [0x8000 + X], A
     SET PC, POP

:printval
     JSR xytox
     JSR printvalatx
     SET PC, POP

:printvalatx
     SET PC, POP

:xytox
     SET B, Y
     MUL B, 32
     ADD X, B
     SET PC, POP

:setcolor
     IFE C, 0
 SET C, 0x1f0
     SET Z, C
     AND Z, 0xff
     SHL Z, 8
     IFG C, 0x1ff 
ADD Z, 0x80
     SET PC, POP

:clrscreen
     SET Z, SP
     SET SP, 0x8000
     :clrscreen_loop
          SET POP, 0
          SET POP, 0
          SET POP, 0
          SET POP, 0
          SET POP, 0
          SET POP, 0
          SET POP, 0
          SET POP, 0
          SET POP, 0
          SET POP, 0
          SET POP, 0
          SET POP, 0
          SET POP, 0
          SET POP, 0
          SET POP, 0
          SET POP, 0
          SET POP, 0
          SET POP, 0
          SET POP, 0
          SET POP, 0
          SET POP, 0
          SET POP, 0
          SET POP, 0
          SET POP, 0
          SET POP, 0
          SET POP, 0
          SET POP, 0
          SET POP, 0
          SET POP, 0
          SET POP, 0
          SET POP, 0
          SET POP, 0
          IFE SP, 0x8200 
SET PC, clrscreen_end
          SET PC, clrscreen_loop

     :clrscreen_end
          SET SP, Z
          SET PC, POP

:strmainmenutitle
     DAT 0x1e1, "OctOS v0.1 - Main menu          ", 0
:strmainmenufoot
     DAT 0x1e1, " Up/Down:navigate - Enter:select", 0

:strmainmenustatus
     DAT " Ship status                  ", 0
:strmainmenuabout
     DAT " About...                     ", 0
:strmainmenubla0
     DAT " Sample item                  ", 0
:strmainmenubla1
     DAT " Another item                 ", 0

:strshipstatus
     DAT 0x1e1, "Ship status:                    ", 0
:strgeneralstatus
     DAT 0x1f0, "General:", 0
:strenginestatus
     DAT 0x1f0, "Engine:", 0
:strshieldstatus
     DAT 0x1f0, "Shield:", 0
:strwhateverstatus
     DAT 0x1f0, "Other stuff:", 0
:strnavinfos
     DAT 0x1e1, "               SPACE - Main menu", 0

:end
     SET PC, end
